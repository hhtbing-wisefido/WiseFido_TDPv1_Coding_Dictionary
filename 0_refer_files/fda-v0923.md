# FDA-v0923

*从 PPTX 文件转换: FDA-v0923.pptx*
---

## 幻灯片 1
OWL Monitor System

---

## 幻灯片 2
### 网络原生 AI:计算的中心化革命
洞察：网络将像水和空气一样普遍存在，而不是稀缺资源。
颠覆：摒弃边缘计算的算力妥协。
核心理念：
IoT = AI 的“感官”
云端 = AI 的“大脑”
网络 = 感官与大脑的“神经系统”
所有设备只是感官，所有智能归于大脑，高速网络成为神经系统
Edge
IoT
IoT
IoT
Cloud
AIBrain
IoT
IoT
IoT
Network-Native AI

---

## 幻灯片 3
### AI 原生架构：从 IoT 感官到 AI 大脑
IoT 设备
仅轻量化设计：设备不承担复杂计算，作为数据的智能采集器
AI 原生数据：数据直接以张量（Tensor）和语义信息（如场景、置信度、上下文）的形式上报，实现与 AI 的无缝对接。
高速网络
事件流驱动：数据以事件流（Event Stream）形式实时传输，即时性。
分层传输：事件触发时发送原始数据，确保AI获得完整、新鲜数据。
AI 中枢（大脑）
全局智能：多源融合，统一决策
自动学习：Alert 事件 → 强化学习信号 → 自我进化
随用随学，降低人工标注与训练成本
应用示例：
测量清晨步行速度，评估神经觉醒度。
通过各床健康基线的变化，评估护理质量。

---

## 幻灯片 4
### 全局智能决策：告别数据孤岛，让系统越用越懂您
事件流驱动：AI的统一语言
打破数据孤岛： 传统架构中，数据需要经过复杂转换，导致信息丢失并形成数据孤岛。 
统一的“AI原生”格式： 我们采用事件流（Event Stream）作为统一的数据传输格式。它不仅包含原始数据（如张量），还附带语义化信息（如场景、置信度、时空关系）和数据来源标识。 
无缝衔接：IoT的输入格式与AI的输出格式完全一致。
自我反馈与协同联动 
无缝的AI Agent间协同： 一个AI Agent的输出可以直接作为另一个AI Agent的输入，形成一个自然的反馈循环。 
如人类般思考： 例如，检测到“长时间未翻身” 触发AI Agent关注“跌倒风险”，实现多维度智能决策。
核心收益：简化与高效
简化架构： 统一的事件流从根本上免去了复杂分层，降低了开发与维护成本 。
自我进化： 事件流作为反馈信号，免去昂贵的人工训练和算法融合成本，自主学习每位老人数据，自主调整阈值

---

## 幻灯片 5
### Tensor-Driven Protocol ： 为AI感知世界而设计
传统数据结构：为查询而生，为AI所限
         传统的IoT数据结构以设备为中心且为查询而设计，这使其丢失了关键的上下文和时序关系，极大地限制了AI的学习和推理效率。
TDP协议的核心优势：
其设计哲学是让数据从产生伊始就富含机器可读的上下文，极大降低AI的处理成本，释放其真正的推理潜能。
极致的上下文丰富性
时空语义原生内置：高精度时间戳、语义化位置和事件主体 ，使AI能瞬间理解“谁”、“何时”、“何地”发生了事件
CodeableConcept结构: 确保了与FHIR/Epic的无缝对接，为数据互操作性打下坚实基础。
无损、多模态的数据承载能力
从信号到语义的全栈支持：同时支持承载原始传感器信号（TensorPayload：雷达点云、音频波形）和轻量级语义结果
专业的张量描述：TensorMetadata详细定义了数据的形状、类型和压缩方式 ，让AI模型无需猜测即可准确、高效地解析原始数据。
专为AI分析设计的语义标签体系
Tags/EventType：结构灵活、易于扩展，使得不同AI模块能基于统一的语义进行沟通与协同，直接形成推理链条。
confidence（置信度）和producer_id（生产者ID）：持续学习与优化提供了天然的反馈数据，并能精准追溯决策来源，增强系统可信度。

---

## 幻灯片 6
管理/设备注册
Lite日常
Extra警报
倒计时警报
MTU主机
睡眠板
Radar
MEMS地震传感
配重铁块
SOS
Wi-Fi6
BLE
typeC
警灯-wifi/BT
MQTT/DLS
多播/TDLS
GATT/BLE
Radar/Senor算法
AI强化学习
Kafka--redis
TimescaleDB-Neo4j
Server-Nvida_jeason
SasS/多租户
TDP:IoT-Server 数据协议 
EntityGraph： EntityGraph统一数据模型：所有实体的定义，时间、地点、人物，关系，护士、老人、房间、设备,FHIR/SNOMED代码
EventChain：推理链的输出，记录因果行为 
未用MySQL: 复杂业务逻辑，代码复杂度非线性增长，不利于AI辅助开发，且未来二次开发
Ubuntu 24.04 LTS
消息队列: Apache Kafka
内存数据库: Redis
时序数据库: InfluxDB或TimescaleDB
图数据库: Neo4j
对象存储: MinIO (自托管)

---

## 幻灯片 7
### 缓存+事件触发+server计算
IoT：仅做简单预警+倒计时报警
无锁环形缓存：确保事件前后3秒数据
普通结构化数据：直接传送
缓存数据：压缩传送
Serve: 复杂计算-取消报警
数据量：
原始数据 (压力/雷达点云/背景音 )：
：10M (事件发生前，存放10/1=10秒）
雷达Raw I/Q  ：存放6/2=3秒）

---

## 幻灯片 8
目标： 500ms完成胸梗/脑卒的即时干预
Web/app-----Server—wifi--N*[ESP32_P4+C5+usb_hub]--typeC----M*[ESP32_S3---ADC-传感器]   （M>N) 
[ESP32_P4+C5+usb_hub]: IoT盒子， [ESP32_S3---ADC-传感器]：传感器      IoT警灯：ESP32_C5--警灯     ESP32_C5: 支持Wifi 6/BT5.3
S3  传感器数据的采集、GPIO时间同步控制、硬件状态监控、通信接口管理 ，
P4   传感器数值转为结构后数据，预警、发送CoAP本地紧急通报(CON）
IoT_current发生异常时，向相关设备收到紧急多播通报(CON确认)后，包含 地点、事件编号、倒计时(default=30秒）
CoAP  超时5秒，重传2次，Retry1:5s，retry2:10S  即15秒后未收到server确认，认为server失败。 Server必须回复CON
关联方自动向Server发送缓存及随后1秒的数据，并持续发送 倒计时时间。倒计时相当于日落条款
当进入紧急情况时，立即多播(NON)发送之前的2秒缓存，每100ms 或原始值超过2kB时发送.
本地一次确认：等待30秒，潜在的预警可由Server取消，或人工取消
 本地二次确认：第25秒时，床头机发起多播警报：相同事件编号，发送者，倒计时=125秒
警笛更新计时器：取消原事件计时器，重新125秒倒计时
如果IoT检测到wifi或Server故障时，直接通过BLE广播，发送本地紧急通报
100ms数据量： 
 2*ptz+2*strain  90hz*4通道*0.1s*3B=108B     通道切换<1ms
esp32-C2—esp32-p4 传输距离 max 6米， usb2.0 max 480MbpsC2 分块读取 雷达RAW(2MB): SPI  256KB, 然后usb2.0发送给P4.

---

## 幻灯片 9
Eps32-C5
P4 32M
Microchip USB2642 4口
Esp32-S3
Esp32-S3
Esp32-S3
Esp32-S3
Radar
2*ICM-20602
2*ADS122C04
I2C音频
PTZ压电/Strain应变
MCU独立，与传感器解耦  软件定义，性能冗余
UART
SPI
I2C
GPIO
USB CDO
氨气

---

## 幻灯片 10
呼吸2*PTZT TLV6002/ OPA388, ADS122C04 (90SPS并开启陷波抗混叠，PGA=64）
高通滤波器 R_bias=1MΩ,C_in=1µf    ~0.16Hz反馈网络：C_f=1nf, R_F=100MΩ  高通截止频率：f_c ≈ 1.6 Hz
抗RFI：R_lpf = 1kΩ, C_lpf = 100nF → fc = 1.6kHz
2*3线制应变器--ADS122C04  翻身与抽畜
(90SPS并开启陷波抗混叠，PGA=128）
抗RFI 的LPF ：R=1kΩ, C=100nF → fc≈1.6kHz
心率 (HR)： 0.5 Hz ~ 2.5 Hz (30 ~ 150 bpm)
呼吸 (RR)： 0.1 Hz ~ 0.6 Hz (6 ~ 36 rpm)
原始信号(30 SPS) → 多路并行滤波 
├── 0.2-1.0Hz → 脑卒预警通道 
├── 0.5-1.5Hz → 胸梗预警通道 
├── 1.0-3.0Hz → 快速抽畜通道 
 └── 0.1-0.5Hz → 呼吸辅助通道
能量计算： 每个频段独立计算信号能量 设置动态阈值（基于个人基线+3σ） 抽畜确认需要持续时间>5秒
协同判断逻辑： 
IF (应变检测到0.5-1.5Hz异常) AND (PTZ检测到心率突变>20bpm) → 胸梗预警 
IF (应变检测到0.2-1.0Hz异常) AND (PTZ检测到HRV异常) → 脑卒预警
 IF (应变检测到抽畜) BUT (PTZ心率正常) → 可能翻身或环境干扰，降低预警权重
ESP32-S3
 |── I2C总线1 → ADS122C04 #1 
│   ├── Channel 0: PTZ1
│   └── Channel 1: PTZ2
└── I2C总线2 → ADS122C04 #2
       |── Channel 0: STRAIN1
      └── Channel 1: STRAIN2

---

## 幻灯片 11
ICM-20602 + ESP32-S3 连接示意图（SPI 模式）地震仪
使用 0.1μF 陶瓷电容靠近 ICM-20602  的 VDD 和 GND 之间滤波
抽样频率:150hz
走路1-3hz    Falling:能量10-100hz
臀部着地 (Pelvic Impact)，冲示能量极高，波形钝，低频为主，肩着地：能量高，尖锐，相地高频
4.物体坠地 频带更窄；
5. 高度 h 越大，P波相对于S波提前的时间会越少。1-1.5m人体falling

---

## 幻灯片 12
### Institutional Model
DeviceA
Server_local
DeviceB
Manage
WARN
MQTT/TLS
CoAP/ OSCORE
Manage：设备注册、心跳、配置下发、IoT数据、报警
WARN: 紧急广播 by Wi-Fi
SOS:紧急广播 by Wi-Fi  BLE
SOS
BLE广播/多播密码签名
SaaS Server

---

## 幻灯片 13
云端计算优先，IoT 自身计算保底
本地上报本地结果，事件触发原始数据上传
备份切换：待网断时(3* windows_time3秒)，超过默认阀值发送SOS报警
Server需在MQTT/TLS 有一个多播共享密码更新机制：q-PSK-启/停用时间, -1表示无穷大，即不启用或不停用

Channel | topic | Protocol/安全 | 物理 | 备注
Manage | IoT/register/all  设备注册-硬件信息 QoS1
IoT/data/all||{device_id} – TDP数据包,Qos0
Server/all/config - 公共配置(多播、NTP、共享密码)QoS1 Server/device/{device_id} - 设备专用配置 QoS1 | MQTT/TLS | Wifi | 
WARN | 紧急广播：由manage中danageLevel报警触发 
报警号(productor_id+seqNo)、dangerLevel\地点UUID、报警计时器 。 不包含PHI | CoAP/OSCORECON | wifi | 3*timeout   未收到ACK时，切换BT SoS
IoT/Server,  仅Server/与发送者有关系的IoT回复
SOS | 通过BlueTooth紧急广播 | Bean/多播密码签名 | BLE | 最后的应急手段
坚固的承诺：双重保障，无惧失联

---

## 幻灯片 14

 | 网段 | 协议及认证 | Timeout:3 S backup:3*T=9s
Manage | 192.168.100.199 | MQTT/TLS | 
WARN | 239.0.0.2:9002 | CoAP/OSCORE | 紧急广播，所有IoT/Server均接收，只有关联方、server  ACK
SOS | Beacon/PSK | BLE 广播模式/使用CoAP PSK签名 | 仅SOS模式才需签名
RooT CA  离线USB
IntermediateCA_C
cloud
IoT_A： 获取设备身份证书 
1.TRNG- privateKey
2.Gen private/pubKey
3. Send  CSR to interCAC
4.Get root Certificate/Device_certAC
4.RooTCA证书
Device_certA_Cloud
3.证书签名请求（CSR）：deviceA_pubKey
IntermediateCA_L 
Local： Server
IoT_B：在机构处获取设备身份证书 
1.TRNG- privateKey
2.Gen private/pubKey
3. Send  CSR to interCAL
4. 4.Get root Certificate/Device_certBL
3.证书签名请求（CSR）：deviceB_pubKey
4.RooTCA证书
Device_certB_Local
trust
如果A无法联网，将不能与本地的B/ICA_L建立trust
Server—IoT 双向认证

---

## 幻灯片 15
1. 设备身份注册阶段（在工厂完成）
为每台 WiseFido 设备生成一个独一无二的、受信任的身份。这个过程与客户无关。
生成密钥对：在设备生产阶段，设备内部的安全硬件（如 Secure Element）会生成一个独一无二的私钥和对应的公钥。
生成 CSR：设备将这个公钥和自己的唯一身份信息（如 UUID）打包成一个证书签名请求（CSR）。
发送给 WiseFido CA：设备将 CSR 发送给您自己管理的 WiseFido CA 服务器。
CA 签发证书：您的 CA 服务器收到 CSR 后，用CA 的私钥对设备的公钥进行签名，然后生成一个设备证书。这个设备证书就包含了设备的公钥和 CA 的签名。
安全存储：您的 CA 服务器将生成的设备证书和 CA 的根证书（用于证明自己的身份）发回给设备。设备将这些证书安全地存储在硬件中。
2. 同理WiseFido 为客户服务器生产 服务器证书
3. mTLS 握手
客户端发起连接：设备向服务器发送一个 ClientHello 消息。
服务器响应：服务器发送其证书、加密算法等信息，并要求客户端也发送其证书。
客户端出示证书：设备将之前写入的客户端证书发送给服务器。
服务器验证：服务器验证客户端证书的合法性。
客户端签名：这是关键步骤。服务器会发送一个随机数或数据，要求客户端使用其私钥进行签名。此时，设备不会导出私钥，而是将签名请求发送给硬件安全模块。
硬件安全模块签名：硬件模块在内部使用其私钥对数据进行签名，然后将签名结果返回给设备。
客户端发送签名：设备将签名结果发回给服务器。
服务器验证签名：服务器使用客户端证书中的公钥来验证签名的有效性。如果签名匹配，则证明设备确实拥有该证书对应的私钥。
4.  建立加密通道
一旦双方身份都得到验证，一个共享的会话密钥将被生成，并用于加密后续的所有数据传输。这个加密通道就是mTLS 加密通道。
1. 设备认证

---

## 幻灯片 16
IoT/server 证书 +（接入授权）
BLE配网阶段
1. BLE连接IoT设备
2. 传输WiFi配置
3. 传输机构接入密码(机构A在server上设置， 可选项)
4.业务授权：app扫描二维码将uuid传入server，
5. 人工审核，绑定房间、住户
方案 B：基于物理凭证的离线验证
设备出厂：每台设备都配有一个唯一的二维码。该二维码与设备的硬件私钥绑定，并将二维码和公钥存入 厂家数据库。
客户接收：APP 预装了您的 CA 根证书。
离线认证：客户用手机扫描设备上的二维码或 NFC 标签。
验证流程：
移动应用读取设备上的物理凭证。
应用连接到设备的蓝牙，要求设备使用其硬件私钥对一个随机数进行加密签名。
移动应用将签名、随机数以及物理凭证上的唯一标识发送给厂家服务器进行验证。
服务器验证：厂家服务器根据二维码的唯一标识，在数据库中查询对应的公钥，并验证设备的加密签名。如果签名匹配，则设备真。
业务授权：一旦验证通过，服务器将设备与客户机构进行绑定，完成业务授权。
一个 X.509 证书： 证书持有者的公钥、 证书持有者的身份信息、 颁发者信息CA、证书有效性-起止时间、数字签名： 颁发者（CA）使用其私钥对整个证书进行签名
使用 CA 公钥验证签名的过程
当你的 ESP32 设备收到服务器的证书时，它会执行以下验证步骤：
获取公钥： ESP32 已经预先存储了 CA 的公钥（这是信任链的基础）。
重新计算摘要： ESP32 也会对整个证书文件（除了数字签名部分）执行与 CA 完全相同的哈希运算，得到一个新的摘要。
用公钥解密签名： 然后，ESP32 使用 CA 的公钥对证书底部的数字签名进行解密。解密后，它会得到 CA 在第一步生成的原始哈希摘要。
对比摘要： 最后，ESP32 将自己重新计算出的摘要与解密后得到的原始摘要进行对比

---

## 幻灯片 17
1. 心率与呼吸暂停-无条件报警
心率过缓（Bradycardia）: 心率 < 40 bpm，持续 10 秒以上。
DangerLevel: EMERGENCY
Tag: Physiological.Bradycardia.Confirmed
心率过速（Tachycardia）: 心率 > 130 bpm，持续 10 秒以上。
DangerLevel: EMERGENCY
Tag: Physiological.Tachycardia.Confirmed
呼吸暂停（Apnea）: 呼吸率 < 5 次/分钟，持续 10 秒以上。
DangerLevel: EMERGENCY
Tag: Physiological.Apnea.Confirmed
呼吸急促（Tachypnea）: 呼吸率 > 28 次/分钟，持续 10 秒以上。
DangerLevel: EMERGENCY
Tag: Physiological.Tachypnea.Confirmed
设备固件的硬编码规则，确保在最紧急的情况下，即使网络中断，也能做出即时响应
Alarm:人工确认取消          Suspicious alarm:倒计时警报，AI复查确认后，取消或立即警报;
2. 跌倒-无条件报警
DangerLevel: EMERGENCY
Tag: Safety.Fall.Confirmed
3. 卫生间长时间滞留-因人而定
检测到有人进入卫生间，持续超过 1 小时,内置订时器
       DangerLevel: ALERT 
       Tag: Safety.ProlongedStay.Bathroom
4. 离床/ 因人而定
离床: 睡眠时段 (SleepPeriod) 内，行动不便者上床5分钟后再次离床
DangerLevel: WARNING (属于预警性质，需要关注)
Tag: Safety.ProlongedAbsence.Bed 或afety.ProlongedAbsence.Home
IoT Safe Mode

---

## 幻灯片 18
IoT Radar  计算取代状态机
IoT 终端：构建并维护矩阵
云端（Server）：下发规则引擎，更新关健矩阵数据
Person Matrix：跟踪和描述动态的人体目标，由IoT本地更新
Object Matrix: 静态或准静态的物体和环境特征，云端下发
规则引擎，由云端下发
规则0：基础存在性规则
规则1：核心安全预警规则 
规则2：物体与环境交互规则 
标准输出： TDP事件流、本地报警确认、警笛指令
软件定义”和“数据驱动
矩阵：固定、连续、可预测， 函数式编程思想，便于升级迁移
规则：独立，无状态转移，可通过云端下发，仅依赖当前矩阵数据

---

## 幻灯片 19
Sleep pad
硬件
原厂：
eps32-WROOM-32----HX711/MCP6234---1.7米5芯mico-B排线----2*（ptz压电+3线制应变传感器
1.7米直接传输模拟信号，存在干扰，
新方案
eps32-P4-----2米typeC------7cm*50cm压力板[---TI ADS122C04---2*(ptz压电+2*3线制应变传感器）左右
一颗ADS122C04有4个模拟输入引脚（AIN0, AIN1, AIN2, AIN3）。通过内部多路复用器，可以配置为多种差分或单端组合。最合理的配置方案：将6路信号全部配置为【单端输入】模式。
PTZ传感器 (2路)：PTZ信号是动态交流信号，且幅度相对较大。
连接： 2个PTZ传感器的信号线分别连接至 AIN0, AIN1, AIN2。参考地： 它们的地线都连接到模拟地（AGND）。ADC内部配置为单端输入时，会自动以AGND为参考测量这些引脚电压。
应变片传感器 (2路)：应变片是桥式输出，需要差分测量以获得最佳抗噪性能和高共模抑制比（CMRR）。解决方案： 使用3线制连接法，并牺牲一个通道作为公共参考点。
  将 AIN3 作为参考电压引脚。将三个应变片电桥的输出正端分别连至 AIN0, AIN1, AIN2 (与PTZ复用引脚)。将三个应变片电桥的输出负端全部连接至 AIN3。
测量原理：当要测量第一个应变片时，配置MUX为 (AIN0 - AIN3)。测量第二个时，配置为 (AIN1 - AIN3)。测量第三个时，配置为 (AIN2 - AIN3)。优点： 仅用4个引脚就实现了3路差分测量。由于应变片测量是低速的，可以通过时分复用的方式循环采样，由MCU控制
心率 (HR)： 0.5 Hz ~ 2.5 Hz (30 ~ 150 bpm)
呼吸 (RR)： 0.1 Hz ~ 0.6 Hz (6 ~ 36 rpm)
ADS122C04：采样(DR) 90 SPS ，是电源50-60hz工频倍数

---

## 幻灯片 20
### 基于 90 SPS 的信号处理流程修正
#### 1. 预处理
*   **软件带通滤波 (Bandpass Filter)**：目的： 隔离出心率和呼吸信号，剔除极低频漂移（如体温变化、传感器慢变）和残余高频噪声。
*   **通带范围**： **0.5 Hz - 4.0 Hz**。
        *   **为什么是4.0Hz？** 为了保留心率的主要谐波成分，这对时域波形分析和某些特征提取算法很重要，同时也能有效抑制更高频的噪声。
#### 2. 特征提取 (在90 SPS的数据流上进行)
*   **时域分析**：
    *   在90 SPS下，一个心跳周期（例如1秒，60bpm）包含90个数据点，这**足够**用于波峰、波谷检测。
    *   可以使用简单的阈值法，或更先进的算法如**Pan-Tompkins算法**（在心电中常用，可适配BCG）来检测主峰（J峰）。
*   **频域分析**：
    *   对一段时间的窗口（例如 **15秒** 的数据，即 15 * 90 = 1350 个点）进行**FFT（快速傅里叶变换）**。
    *   1350个点做FFT，可以在频率域提供足够的分辨率来精确找到心率和呼吸频率的峰值。
#### 3. 通道融合与后处理
*   **通道质量评估**： 计算每个通道在**心率和呼吸频带内的信号能量**与**带外噪声能量**的比值，作为信噪比(SNR)的估计，用于加权融合。
*   **后处理平滑**：
    *   **卡尔曼滤波 (Kalman Filter)** 或 **移动平均 (Moving Average)**： 用于平滑最终的心率和呼吸结果输出。
    *   **异常值剔除**： 设置一个生理学上合理的范围（如心率<40或>150为无效值），剔除明显错误的瞬时结果。
### 总结：您的算法参数体系
*   **ADC采样率 (Fs)**： **90 Hz**
*   **软件带通滤波器通带**： **0.5 Hz - 4.0 Hz**
*   **FFT分析窗口长度**： **15秒** (1350个样本点)
*   **心率搜索范围**： **0.5 Hz - 2.5 Hz** (对应 30 - 150 bpm)
*   **呼吸搜索范围**： **0.1 Hz - 0.6 Hz** (对应 6 - 36 rpm)                                                           相关文档：sleepad原始数据.md
Sleep pad
算法-概论

---

## 幻灯片 21
一个频带信噪比（Bandwise SNR） 或 信号质量指数（SQI - Signal Quality Index）。其核心思想是：一个高质量的生理信号，其能量应该高度集中在心率和呼吸所在的特定频率范围内。
SQI_channel_x = Energy_in_Band_HR / (Energy_Total - Energy_in_Band_HR + epsilon)   epsilon 是一个极小值（如1e-6），防止分母为零。
第一阶段：搭建数据流管道：编写嵌入式代码，配置ADS122C04以90 SPS的速率稳定采样6个通道。实现一个乒乓缓冲区或环形缓冲区，确保数据流不会丢失。为每一组6通道的采样数据打上精确的时间戳。
第二阶段：核心算法开发 
1. 多通道质量评估与融合 (取代简单的选择)实时SQI计算： 如我们之前详述，为每个通道计算基于频带的信号质量指数（SQI）。
动态加权融合策略：
方案A（加权平均）： 对每个通道独立计算出心率值，然后用SQI作为权重进行加权平均。最终心率 = (SQI1*HR1 + SQI2*HR2 + ...) / (SQI1 + SQI2 + ...)
方案B（特征融合）： 在特征层进行融合。例如，用SQI加权融合各通道的频谱或自相关函数，再从融合后的结果中提取心率。这种方法通常更鲁棒。
2. 多方法心率估计与仲裁 (核心引擎)
并行运行多个估计器：
A. 频域估计器（FFT）： 最稳定。对一段时间的窗口（如15秒）做FFT，在频谱上寻找能量最高的峰值作为心率。优点： 抗噪性好，不易减半/翻倍。缺点： 响应慢，延迟高。
B. 时域估计器（波峰检测）： 响应最快。在滤波后的时域信号上检测BCG波的J峰，计算心跳间隔（RR间期）。优点： 延迟极低，能捕获瞬时变化。缺点： 容易受噪声干扰产生误检或漏检。
C. 混合估计器（自相关）： 平衡之举。计算信号的自相关函数，其峰值对应的时延就是心跳周期。优点： 介于A和B之间，兼具一定的抗噪性和速度。
设计仲裁机制： 这是算法的“大脑”。根据当前的信号质量（SQI）来决定信任哪个估计器的结果。
高SQI时： 优先信任时域估计器的结果，以获得最快的响应速度和高时间精度（用于HRV）。
低SQI时： 优先信任频域估计器的结果，以保证结果的稳定性，防止 nonsense 输出。
中等SQI或结果冲突时： 参考混合估计器的结果，或进行投票决策。
3. 后处理与平滑
异常值剔除： 设定生理学合理范围（如40-150 bpm），剔除明显离谱的瞬时结果。
平滑处理： 使用卡尔曼滤波（Kalman Filter） 或 低通滤波 对最终输出的心率值进行平滑，避免数值剧烈跳动，
Sleep pad
算法-SQI

---

## 幻灯片 22
1. 2. 6ms滑窗检测与J波确认（核心）
流程： 对每个通道独立进行：
1. 在一个6ms的滑动窗口内寻找局部极大值（或极小值，根据安装极性）作为J波候选。
2. 记录该候选点的`幅度`和`精确时间戳`。
跨通道共识（“多数投票”）：
收集当前时刻所有通道的J波候选。
决策： 如果在同一个6ms时间窗内，有至少 N 个通道都报告了J波候选，则确认一个心跳事件。
阈值N的建议： 起始值可设为 `N=3`。这是一个平衡点，既能容忍最多3个通道失效，又能保证至少3个通道达成共识，可靠性极高。您可以根据实际测试调整该值（如更严格则设N=4）。
3. SQI过滤（优化投票质量）
作用： 在“多数投票”前，先进行通道质量筛选，防止低质量通道的候选点参与投票，污染共识。
实现： 设置一个SQI阈值。
实时计算每个通道的SQI（例如，基于幅度的稳定性、与邻近通道的相关性等）。
只有SQI高于阈值的通道，其报告的J波候选才具备“投票权”。
示例： 即使6个通道都有数据，可能只有4个通道的SQI达标。这时，如果这4个通道里有3个在6ms内达成共识，即可确认心跳。
4. 心率计算与鲁棒性验证
心率计算： 心跳事件确认后，用本次的权威时间戳（可取达成共识的多个时间戳的平均值）减去上一次的权威时间戳，得到RR间隔，进而计算瞬时心率。
“连续性验证”机制（您的核心创新）：
维护一个短期历史心率队列（e.g., 存储最近5个有效心率值）。
规则： 若当前心率值`HR_current`满足以下条件之一，则视为有效：
1. `HR_current`与历史平均值`HR_avg`的差异在预设范围内（e.g., ±10%）。
2. `HR_current`与上一个值`HR_prev`的差异在预设范围内（e.g., ±20%）。
若当前心率不满足上述条件，则将其标记为“可疑”，不立即输出，而是启动备份估计算法。
5. 备份机制（最终保障）
目的： 当“连续性验证”连续多次失败，说明时域峰检可能因严重干扰而暂时失效。此时需要启用更鲁棒、但延迟稍高的备份算法。
方案： 启用一个基于频谱分析（FFT） 或自相关的心率估计器。
它运行在较高的延迟下（e.g., 分析过去15秒的数据），提供一个趋势性的、更稳定的心率估计值。
这个备份值不用于高精度HRV分析，但可以保证系统始终有一个合理的心率输出，直到时域峰检共识机制恢复正常。这也是处理用户长时间剧烈运动（如翻身）后心率重新捕获的最佳策略。
A[6通道ADS122C04数据输入] 
--> B[并行单通道处理]
B --> C[6ms滑窗J波候选检测]
C --> D[计算各通道SQI]
D --> E{"有效通道数 >= 阈值?"}
E -- 否 --> F[丢弃事件]
E -- 是 --> G[确认心跳事件<br>记录权威时间戳]
G --> H[计算RR间隔与瞬时心率]
H --> I{连续性验证<br>检查当前与历史值}
I -- 通过 --> J[输出稳定心率值]
I -- 未通过 --> K[触发恢复机制]
K -- 启用频谱估计备份 --> J
Sleep pad
算法-心率

---

## 幻灯片 23
目标： 在每个通道上，独立地、简单地寻找可能是J、I、K波的事件点，不急于判断它们是否是一个完整心跳。
J波检测 (主特征)：寻找信号中绝对值最大的峰值（或谷值，取决于安装极性）。这是最显著的事件。记录其幅度和时间戳。
I/K波检测 (辅助特征)：在J波时间戳的前后一个生理学合理的时间窗口内（例如J波前100ms，后200ms），寻找另一个显著的波峰或波谷。
逻辑简化： 甚至可以不做严格区分，只记录J波附近最显著的两个极值点及其与J波的时间差和幅度比。
输出： 每个通道，在每个心跳周期，输出一个特征集合：{ timestamp_J, amplitude_J, timestamp_Near1, amplitude_Near1, deltaTime1, timestamp_Near2, amplitude_Near2, deltaTime2 }
第二步：计算单通道SQI
目标： 为每个通道的当前这个心跳事件计算一个可信度分数。
稳定性指标： 与该通道的前几个心跳的周期做比较，看间隔是否稳定。
形态学指标： 检查I、J、K波之间的时间差和幅度比是否在一个合理的生理范围内（e.g., J-I间隔 ~50ms, J-K间隔 ~200ms）。这个范围可以设得比较宽，主要用于剔除明显的离群值。
能量指标： 计算J波幅度是否显著高于背景噪声。
输出： 每个通道，对于当前心跳，输出一个SQI_channel_current值。
层级 1: 通道健康度评估 (频谱能量SQI)
计算： 每15-30秒，为每个通道计算一个SQI_spectral。
用途：翻身，有些通道可能会暂时失效或受到干扰。
通道开关： 如果某个通道的SQI_spectral持续极低，可以暂时禁用该通道，不让它参与投票，因为它可能被完全覆盖（如传感器失效、被重物压住）。
权重初始化： 在实时融合时，各通道的初始权重可以基于它们最近的SQI_spectral值。
层级 2: 单事件质量评估 (单事件SQI)
计算： 每个心跳事件产生后，立即为它计算一个SQI_event。
用途：过滤掉低质量事件，防止它们影响最终结果。
实时加权： 在跨通道共识时，使用SQI_event作为权重，高质量的事件有更高的投票权。
事件过滤： 如果一个事件的SQI_event低于阈值，可以直接丢弃，不参与后续计算。
主力使用指尖血氧仪（PPG）作为对比参考
直接对比： 将您的BCG算法检测到的J波时间点，与PPG的脉搏波峰值时间点进行对比，可以直接计算检测误差和成功率，调试效率极高
BCG更适合作为医生的辅助参考工具和长期趋势评估工具，而非用于一次性临床诊断的独立依据
认证类型 /核心要求/ 推荐参考设备/ 对比重点
FDA（医疗设备）/测量绝对精度  /ECG   /每个心跳时间戳的误差（毫秒级）
UL 2650（应急系统）/ 报警功能可靠性/ PPG / 报警事件的误报率、漏报率
Sleep pad
算法-心率

---

## 幻灯片 24
R-R 间期计算：记录连续两个 J 峰的时间差 瞬时心率：HR = 60 / RRI（秒） 平滑输出：用移动平均或IIR滤波平滑
路径1：显示用 HR [原始信号] → [滤波] → [J峰检测] → [R-R间期] → [IIR平滑] → 显示HR
用长时间常数平滑（如 IIR α=0.1，响应慢，稳定）
路径2：报警用 HR
✅ 方法 1：在 R-R 间期序列 上直接检测异常（推荐）
中风或癫痫前兆常表现为：
心率突然剧烈升高（如从 70 → 120 bpm）
心率剧烈波动（R-R 间期标准差显著增加）
出现短阵心动过速（连续 3 次 R-R < 0.5s
✅ 方法 2：使用 双时间常数平滑
显示用 HR：用长时间常数平滑（如 IIR α=0.1，响应慢，稳定）
报警用 HR：用短时间常数或不平滑（实时响应）
✅ 方法 3：直接分析 PPG/BCG 波形形态变化
中风或自主神经异常可能导致：
J 峰幅度剧烈变化
波形畸变（如 dicrotic notch 位移）
呼吸波包络不规则
阶段1：3个R-R快速触发，连续3个RR<0.5s?   阶段2： 保存波行+形态分析
第二级：直接分析 PPG/BCG 波形形态（关键！）
一旦触发，立即从环形缓冲区提取最近 10–30 秒原始波形，进行深度分析。

分析项 | 指标 | 异常表现
1. 波形能量 | RMS 或 峰峰值 | 显著升高（抽搐时体动）
2. 频谱特征 | 5–15 Hz 能量占比 | 增加（肌肉震颤）
3. J峰形态 | 幅度、斜率、对称性 | 畸变、消失、分裂
4. 呼吸波包络 | 幅度变异性 | 呼吸急促或暂停
5. 心率变异性 (HRV) | SDNN, RMSSD | 显著降低（自主神经紊乱）

---

## 幻灯片 25
呼吸算法设计
呼吸信号的提取通常比心率更困难，因为其幅度更小，更容易受到身体轻微移动的干扰。但由于我们已经有了心跳信号这个“锚点”，我们可以设计出非常鲁棒的方案。
核心原理：频率分离 + 幅度调制
呼吸会引起胸腔的缓慢起伏，这会对BCG信号产生两种影响：
低频基线漂移： 呼吸本身是一个频率很低的信号。
幅度调制效应： 胸腔的充气和排气会轻微改变心脏与床垫的相对位置，从而调制（微弱的改变）心跳J波的幅度。
方案一：基于低频带的呼吸提取（主要方法）
这是最直接的方法，直接从原始信号中提取呼吸成分。
预处理：源信号： 使用未经0.5-4.0Hz滤波的原始信号，或者使用该滤波器的输入信号。
抗混叠滤波： 先用一个截止频率较低的滤波器（如 1Hz）滤除高频噪声，为降采样做准备。
降采样 (Decimation)： 将采样率从90 SPS降低到，例如，5 SPS。因为呼吸频率极低（<0.5 Hz），根据奈奎斯特定理，5 SPS的采样率绰绰有余。降采样可以极大减少数据量，降低计算复杂度。
带通滤波：设计一个通带为 0.1 Hz - 0.5 Hz 的数字带通滤波器（如IIR滤波器），用于提取呼吸频带。
这个滤波器会输出一个平滑的、缓慢振荡的波形，这个波形的频率和相位就直接对应了呼吸的节律。
波峰/波谷检测：在这个平滑的呼吸信号上，寻找波峰（对应吸气末）或波谷（对应呼气末）。
计算连续波峰之间的时间间隔，即可得到呼吸周期和呼吸率（RPM）。
方案二：基于J波幅度的呼吸提取（辅助验证方法）
这个方法非常巧妙，利用心跳作为“采样点”。
数据源： 使用经过0.5-4.0Hz滤波后的信号。
幅度提取：对于每一个通过共识算法确认的有效心跳，记录其J波的幅度值 (amplitude_J)。
这样就得到了一个时间序列：(t0, amp0), (t1, amp1), (t2, amp2), ... 这个序列的采样率是不均匀的（取决于心率），但它包含了呼吸引起的幅度调制信息。
信号重建与提取：对这个幅度时间序列进行插值，重建成一个均匀采样的信号。
对这个重建后的信号应用一个低通滤波器（截止频率 ~0.5 Hz），滤除高频波动，留下的低频变化就是呼吸信号。
呼吸率计算：同样地，在这个低频信号上寻找波峰/波谷，计算呼吸周期和呼吸率。
主路径： 以方案一（低频带提取） 为主要方法。因为它直接、可靠。
辅助验证： 运行方案二（J波幅度调制） 作为一个独立的呼吸率估计器。
共识输出：
如果两个方法得出的呼吸率在合理范围内（例如，差异 < 5 RPM），则取平均值或选择SQI更高的那个作为最终结果。
如果两个方法差异巨大，通常意味着方案一（低频提取）受到了低频率噪声（如身体缓慢移动）的污染。此时，可以优先信任方案二（J波幅度）的结果，因为它天生对这类运动不敏感。
Sleep pad
算法-呼吸

---

## 幻灯片 26
地震仪算法    
1. 抽样频率 (Sampling Rate) 选择  200hz
2. 多层次的决策流程：
第一层：触发检测
判断是否有振动事件发生（能量超过基础阈值）。没有则继续等待。
第二层：特征提取
计算事件的能量、持续时间、频谱。
计算TDoA，并推断震源的大概位置。
第三层：分类决策 (最重要)
规则1：如果能量 低于 “跌倒阈值”，归类为 日常干扰（走路、轻微触碰）。
规则2：如果能量 很高，但持续时间 很短，且震源位置来自桌面/墙角，归类为 东西坠地。
规则3：如果能量 很高，持续时间 较长，则判定为 疑似跌倒。
规则4：在判定为疑似跌倒后，可以启动一个延时报警（如30秒），并在这期间检测是否有后续活动（如自主站起）。若无活动，则最终确认为跌倒并报警。
ESP32-C2: 数字陷波器： IIR（无限脉冲响应）陷波滤波器，60hz/180hz
MEMS-地震算法

---

## 幻灯片 27
整体方案概述
构建1.8米以下空间的高清静态背景图（主要是家具和墙面），并通过“慢慢填充每块”来提高分辨率和细节。预先知识避免无效房间：通过检查点云密度、范围分布和一致性，排除空房间、噪声主导或超出预期尺寸的场景（e.g., 点数<100或范围>10米）。
高处（2-3米）处理：先用SVD检查墙是否垂直（非倾斜），如果通过，再用RANSAC拟合墙平面，建立距离模型。低处（<2米）处理：假设所有凸起为家具。先拟合墙面，如果平均距离比高处变长（阈值0.2米），则视为潜在内凹陷或多径干扰，再用SVD清理点云。
第1步：多帧累积与3D-FFT 变换,三维栅格化
 1. 1. 配置雷达的工作参数
1. 2. 多帧累积： 连续采集，时域上叠加平均
1. 3. 3D-FFT 变换：：生成距离-多普勒-角度数据
1. 4. 目标点云生成与 CFAR 检测
1.5 初步三维栅格化与过滤(速度/边界过滤）
第2步：几何过滤与墙面建模
 2.1 数据分割与高度过滤
2.2 墙面候选识别（SVD）
2.3 鲁棒平面拟合（RANSAC）
2.4 房间模型生成与空间过滤
第3步：室内多径过滤与全局背景图生成
3.1 “最短路径”过滤
3.2 Capon 波束成形
第4步：智能识别与高危区域定位
 4.1 2D边缘检测
4.2 DBSCAN 与家具高度判断
4.3 PointNet点云分类
第5步：特定区域超高清计算
 5.1 筛选关键区域
5.2 MUSIC 算法应用
第6步：背景图融合与更新
 6.1 ICP 精准配准
6.2 最终背景图生成
雷达算法
补充：PointNet模型先标注，然后投影到2D平面，用矩形，圆形简单表示，用不同color表示高度，在web上展示，让用户再手工修改，并反馈给PointNet AI。 地震TDoA 可计算人的走动位置、方位，可与雷达相互映证。详见：Radar高清背景图及AI思考.md

---

## 幻灯片 28
雷达算法
本地报警
1. 初始化阶段 检查本地默认配置 ini
2. 设备注册，与server交换证书，身份验证
3. 上传本地ini并根据server的最新配置进行更新
4. 进行NTP校时及雷达检测，验证关联设备ID
5. 建立本地高清背景图 
6. IoT 非SDK报警的流程处理
6. 1 建立人员矩阵
6. 2  建立物体/环境矩阵
6. 3  建立报警规则(由server下发，无状态）
 基础0：基础存在性规则
规则1：核心安全预警规则
规则2：物体与环境交互规则
7. 雷达SDK报警时
本地首次确认机制：
开始延时报警30秒，并发送紧急通知：
本地语音询问： Are you OK? 并等待30秒， 
持续将本地录音发送至Server
如果30秒内,否定优先>肯定>未知
未跌倒：取消报警
跌倒：L1 跌倒警报
            未回复：床头机二次确认
床头主机二次警报：
 25秒时发送 150秒报警倒计时:相同事件号ID
床头紧急呼吸系统：闪烁并语音询问： Are you OK?
持续将本地录音发送至Server
如果150秒内，（未否认=确认)
1.Cancel 报警计时器
2. SOS按键：L1警报
3.未回复：L1警报
危险区点云图变化跟踪（危险区： 一般是指低矮家俱，浴室门栏处，由静转动的区域，如床/沙发/马桶，久坐再起的地方）
危险区必须是高度低于60cm的空间 点云分布形态变化超过30%，
通常来说，雷达监测呼吸和心率的有效范围是相对较短的。
呼吸监测： 一般在 1 米到 5 米 的范围内效果最好。
心跳监测： 体表位移（通常小于 1 毫米），有效监测距离更短，通常在 1 米到 3 米
中风/脑梗预警：起床前/由静(>5min)转动  检测呼吸/心率/身体抽畜/起身速度
相关文档：Radars本地报警机制.md 床头主机收到二次警报确认请求.md

---

## 幻灯片 29
完整的轮椅处理状态机首先：识别
1. 状态判断条件 (“视场内无人”)
条件：(轮椅速度 < 0.1 m/s) && (持续5秒) && (其他被跟踪的“人”目标数量 == 0)
说明：这个条件确保了轮椅处于静止状态，并且没有其他人在旁边活动（比如护理人员刚离开），此时系统才需要关心椅上的人是否安全。
2. 启动“凝视”与生命体征监测
操作：当上述条件满足时，MCU/Server立即执行以下操作：
指定门距：将雷达波束（或处理焦点）完全集中在轮椅座位的空间区域。
切换雷达模式：可能需要调整雷达参数（如提高Chirp重复频率），以优化对微弱胸腔运动的检测灵敏度。
提取相位信号：对该区域内的原始I/Q信号进行高精度相位解调。
生命体征分析：使用带通滤波和算法（如FFT、小波变换）从相位信号中分离出呼吸和心跳频率。
3. 最终决策与警报
成功检测到生命体征：系统判定“椅上有人，状态正常”。系统记录此状态，并持续监测生命体征是否在正常范围内。
无法检测到生命体征：这分为两种可能：
椅上无人：这是最好的情况，系统可以标记为“安全”，并停止监测。
椅上有人但已失去意识：呼吸和心跳过于微弱无法检测，或者人已从轮椅上滑落（地上无人）。这是极高风险的紧急情况！
触发警报：对于第2种情况，系统必须触发最高级别的警报：“检测到人员异常静止，可能失去意识！”
移动模式：轮椅的移动是完全平移的。用户的驱动（手部划轮）和电机的驱动，产生的都是平滑、匀速的线性运动。对比人类：人走路时，躯干有轻微的左右摇摆，步伐有加速和减速，有双脚交替的周期性。这种非线性的、有加速度变化的运动模式是雷达识别人类的关键特征。
微多普勒特征缺失：
坐轮椅的用户，其腿部是静止的，无法产生行走时腿部的周期性微多普勒特征。虽然手臂在划动，但手臂运动的微多普勒信号相对较弱，且容易被轮椅强大的金属回波所淹没
因此，轮椅的整体微多普勒谱图看起来更像一个移动的金属物体，而不是一个“正在运动的人”。
完整的轮椅处理状态机
移动的轮椅  速度〉0.2时，识别为有人，且轮椅最高点超过1.5米时，视为推行者
 有人移动从轮椅处移动且轮椅最高点下降：推行者离开
当检测到离开为2人时，将轮椅标识由X改为0
轮椅静止5秒，且标识不为0时，静态扫描，监听呼吸心率，若无，标志为0;若有正常范围内的呼吸心率且持续5秒，标识为有人1，持续跟踪。
系统保持一个轮椅所在栅格的快照，当变化>30%,且期间无人时报警。

---

## 幻灯片 30
### SOS Handle
SOS (紧急呼叫)：SOS (紧急呼叫) - 采用 TCP 或 MQTT：
协议：应使用可靠的、面向连接的协议，如 TCP 或基于 TCP 的 MQTT。
优点：
保证送达：TCP 会持续重发数据包，直到收到服务器的确认。如果服务器宕机，TCP 连接会断开，设备能立刻感知到，从而可以触发你的“备用模式”（本地报警）或切换到备用网络。
即时性：紧急呼叫要求系统立即做出响应。
视觉反馈：
按下后：红色灯光持续闪烁，表示呼叫正在发送中。
接通后（收到服务器确认）：红色灯光保持常亮，代表“警报已发出且已被接收”。这比变为绿色更安全，因为绿色可能会让用户误以为警报已经处理完毕。
紧急情况：主动或被远端紧色呼叫时，闪烁红光且有警报声
触感反馈
红色凹陷设计：这是一种出色的防误触设计接通后（收到服务器确认），SOS字符凸起
Cancle: 
图标：黑色方框凸起
中断所有通话
Call (普通呼叫) - CoAP：
协议：应使用轻量级、无连接的协议，如 UDP 或基于 UDP 的 CoAP。
优点：
高效：UDP 协议开销小，传输速度快，非常适合非紧急的日常数据传输。
节约资源：设备不需要保持持续的连接，更省电。
视觉反馈：
按下后：橘色灯光闪烁，表示呼叫正在发送。
接通后：保持绿色或持续橘色，表示呼叫已被后端系统接收。
被呼叫时，橘色灯光闪烁并响电话铃
触感反馈
黄色，有电话图标凸起
Light灯光：
侧边，白色手电筒标识，按下常亮，再按关闭

---

## 幻灯片 31
如何从警报转入语音对话阶段？
一旦警报得到确认，系统就可以从**“紧急警报”模式平滑地转入“双向语音对话”模式**。这个过程需要设备和 App 之间的协同工作，并且应该使用不同的通信协议。
1. 确认警报并启动语音模式
手柄端：SOS 手柄在收到护士 App 发来的确认数据包后，停止发送 SOS 警报广播。
视觉反馈：SOS 按钮的灯光从红色闪烁变为红色常亮。这清晰地告诉用户，警报已被接收，设备已准备好进行下一步操作。
App 端：护士的 App 在发送确认后，可以向手柄发送一个启动语音模式的指令。
2. 建立语音通信
协议：由于语音通信需要低延迟和持续的数据流，通常会使用 UDP 或专门的 VoIP（网络电话）协议，例如 RTP（实时传输协议）。这些协议经过优化，适合实时音频和视频传输。
连接方式：
局域网（本地）：如果护士的 App 和 SOS 手柄都在蓝牙或 Wi-Fi 的有效范围内，它们可以直接建立一个蓝牙或本地 Wi-Fi 连接，进行点对点的语音通信。
云端：如果护士不在现场，语音流可以通过云端服务器进行中转。在这种情况下，SOS 手柄将语音数据流发送到服务器，服务器再将其转发给护士的 App。这确保了远程语音对话的可靠性。
3. 结束语音对话
语音对话结束后，可以通过以下方式中止连接：
手动挂断：护士在 App 上点击“挂断”按钮。
计时器：系统可以设置一个计时器，如果一段时间内没有检测到语音活动，自动结束通话。
数据从哪里来，语音就从哪里走

---

## 幻灯片 32
### 合规
针对养老护理和老年生活设施，你的系统主要需要关注以下几个标准：
UL 2560 - 辅助生活和独立生活设施的紧急呼叫系统
这是专门为你的目标市场量身定制的标准。它侧重于确保系统在这些非医疗、居家式环境中也能可靠运行。
关键点：它会评估系统在跌倒检测、无线连接可靠性、以及在非专业医疗人员（如护理人员）响应时的效率。
ADA（美国残疾人法案）
虽然 ADA 更多地涉及建筑和公共空间的无障碍设计，但其原则也适用于你的设备。
关键点：你的呼叫按钮必须易于残疾人使用，比如视力受损者可以依靠触感识别按钮，或者行动不便者可以轻松够到设备。
CMS（美国医疗保险和医疗补助服务中心）
如果你服务于接受 Medicare 或 Medicaid 资助的机构，这些机构必须遵守 CMS 的规定。
关键点：CMS 对通信计划和应急准备有严格要求，你的系统在这些方面的可靠性是机构合规的关键。
相关文档： FDA_UL2560对系统要求.md    
                         UL 2560 警报区分与可识别.md   
                         UL2560核心清单.md 
	          UL2560紧急呼吸系统测试列表.md
                          FHIR与SNOMED_CT代码.md

---

## 幻灯片 33
UL 2560 的核心要求
1. 警报的优先级和分类 (Priority and Classification)
这是对你的紧急呼叫系统的一个重要要求。系统必须能够区分不同类型的呼叫，并按优先级进行处理。
高优先级 (High Priority)：紧急呼叫（如 SOS 按钮、跌倒警报）。这些警报必须立即、清晰地被接收和显示，通常会覆盖其他低优先级警报。
低优先级 (Low Priority)：非紧急的日常呼叫或故障警报。这些警报可以有不同的显示方式，例如以静默或较柔和的声音提醒，且不会中断高优先级警报。
2. 警报的持久性和复位 (Latching and Reset)
这是一个非常重要的合规性要求，与警报生命周期管理密切相关。
警报闭锁 (Latching)：紧急警报一旦被触发，必须在多个接收点（如护士站、走廊灯）保持可见或可听状态，直到警报被手动取消。这确保了即使护理人员短暂离开，警报仍然存在，不会被忽略。
本地复位 (Local Reset)：警报必须在发起呼叫的设备本身进行手动复位。你的 SOS 手柄上应该有一个物理或软件按钮，用于在医护人员到达并确认情况后，取消警报。这防止了警报在远程被错误地取消。
3. 系统的故障监控和报告 (Fault Monitoring and Reporting)
UL 2560 强调系统必须能够自我诊断并报告任何可能影响其功能的故障。
电源故障：所有非电池供电的关键系统组件（如网关、服务器）必须在电源中断时立即发出故障信号。你的备用电源设计和故障切换逻辑完美符合这一点。
通信中断：如果设备与网关或服务器之间的通信中断，系统必须在设定的时间内（通常是 24 小时内）发出故障警报。 申明 >8H  CR123A (3.0V, 1550mAh)实际~13.95 小时） 3 年后 95%, 
低电量警报：你的 SOS 手柄必须在电池电量低于预期寿命的至少七天前（通常为 7 天），发出低电量警报。这给了维护人员充足的时间来更换电池。
4. 呼叫响应时间 (Call Response Time)
这个标准对紧急呼叫从发起、传输到接收并显示的时间有严格的限制。
快速响应：紧急呼叫必须在60 秒内被中央接收站（如护士站）接收并显示。你的多通道冗余设计（MQTT 和 CoAP over BT）正是为了满足这个要求而设计的。
总而言之，UL 2560 的核心要求围绕着警报的优先级、持久性、系统的自我诊断能力以及快速响应时间。这些要求确保了紧急呼叫系统不仅仅是一个能发信号的设备，而是一个在任何情况下都值得信赖的、能真正挽救生命的工具。

---

## 幻灯片 34
UL 2560 的核心要求还涵盖了以下几个关键方面：
5. 报警与通信的可靠性
这是 UL 2560 最核心的部分，它确保紧急呼叫系统在任何情况下都能正常工作。
无线链路的可靠性：要求系统必须能够在复杂的无线环境中（如 Wi-Fi 干扰、其他蓝牙设备）稳定运行，不能因为无线信号问题而漏掉警报。
故障转移 (Failover)：如果主通信链路（如 Wi-Fi）中断，系统必须能自动切换到备用链路。你设计的 15秒超时切换和蓝牙备份完美契合这一点。
通信确认：每一次紧急呼叫都必须得到接收端的确认。你的方案中，设备收到服务器的确认后，SOS 按钮的灯光会从闪烁变为常亮，这是最直观的体现。
6. 报警的有效性
UL 2560 强调报警信息不仅要能发送出去，还要能被正确理解和处理。
报警区分：系统必须能区分不同类型的警报，例如跌倒、心率异常或手动呼叫。你的设计中，端口号和数据负载可以完美地实现这一点。
可识别的报警：报警必须有独特的、能被立即识别的声光模式。UL 2560 对报警声音的频率、持续时间和视觉指示（如颜色、闪烁模式）都有详细规定，以防止在多个设备同时报警时造成混乱。
L1/手动：红闪(2hz)+70dBA(2000hz)        L2级报警：黄闪 1hz /1000hz      手动call：绿闪0.5hz/低频500hz
7. 系统集成与互操作性
该标准要求紧急呼叫系统能够无缝地融入养老设施的现有生态系统。
与其他系统集成：紧急呼叫信息必须能被发送到多个终端，例如护士站的显示屏、护理人员的手机应用或电子病历系统（EMR）。这要求你的系统必须使用标准的协议和数据格式，如你选择的 FHIR。
可扩展性：系统必须能够轻松地增加新的设备、新的住户，而不需要大规模的改造。你使用的 IPv6 地址作为统一标识符，为未来的扩展提供了坚实的基础。
8. 电源管理与维护
UL 2560 特别关注设备在无人照管时的长期可靠性。
备用电源：所有关键组件，尤其是本地网关和服务器，都必须有备用电源（UPS），以应对停电。
低电量警报：设备必须能主动报告自己的电量状态，并在电量过低时发出警告。这确保了在电池耗尽前，维护人员有足够的时间更换电池。

---

## 幻灯片 35
UL 2560 核心要求的完整补充
确实存在一些遗漏，例如用户界面可用性、安全电气要求、安装环境适应性、测试验证以及文档标签等。这些是 UL 2560 标准中强调的附加要素，确保系统在非急性护理环境中（如养老设施）的整体安全、可靠性和合规性（与 HIPAA、FDA 和 CMS 要求相协调，例如数据隐私和可追溯性）。
1. 警报与通信的可靠性
（原内容保持不变：无线链路、故障转移、通信确认。您的 15 秒超时和蓝牙备份已高度契合。）
2. 警报的有效性
（原内容保持不变：警报区分、可识别的声光模式。您的端口号和数据负载设计符合要求。）
3. 系统集成与互操作性
（原内容保持不变：与其他系统集成、可扩展性。您的 FHIR 和 IPv6 使用确保无缝扩展。）
4. 电源管理与维护
（原内容保持不变：备用电源、低电量警报。您的 UPS 和主动报告机制已覆盖。）
5. 警报生命周期管理
（原补充：警报必须在未确认响应前保持活跃。您的设计可通过二级人类确认和审计日志增强合规性，与 CMS 的问责要求一致。）
6. 用户界面和可用性（补充：遗漏的核心要求）
UL 2560 强调系统必须易于老年或行动不便用户操作，以确保在紧急情况下快速响应。
界面设计：按钮、显示屏和指示灯必须直观、易触及（如大尺寸 SOS 按钮、清晰的颜色编码）。标准规定最小尺寸、对比度和触感反馈，以防止误操作。
可用性测试：系统需考虑用户多样性（如视力或听力障碍），包括语音提示或振动反馈。
与您的设计契合：您的 SOS 按钮灯光变化（闪烁到常亮）已部分覆盖；建议添加语音确认，以提升 HIPAA 下的患者中心性。
7. 安全和电气要求（补充：遗漏的核心要求）
UL 2560 要求系统防止电气、机械和火灾危害，确保在养老环境中的整体安全。
电气安全：符合 UL 60950-1 或 IEC 62368-1，包括防电击、过载保护和接地要求。无线设备需避免电磁干扰（EMI）。
机械和火灾安全：组件必须耐冲击、耐火（如外壳材料），并通过水浸测试（IP 等级至少 IPX4，以防液体溅洒）。
与您的设计契合：您的无线备份需额外验证 EMI 兼容性；整合防火材料可确保 FDA 下的设备安全合规。

---

## 幻灯片 36
8. 安装和环境适应性（补充：遗漏的核心要求）
标准要求系统适应设施的物理环境，包括安装位置和耐用性。
安装要求：设备必须固定在易达位置（如床边、浴室），符合 NFPA 70（国家电气规范）。无线系统需覆盖建筑内和附近区域（如花园），信号强度至少 -85 dBm。
环境耐用性：耐温度（0-40°C）、湿度（至 95% 非凝结）和振动测试，确保在日常使用中可靠。
与您的设计契合：您的 IPv6 标识符支持灵活安装；建议进行现场信号映射测试，以符合 CMS 的设施安全标准。
9. 测试和验证（补充：遗漏的核心要求）
UL 2560 要求系统通过严格测试，以验证整体性能和可靠性。
性能测试：包括模拟故障（如网络中断、多警报并发）和寿命测试（至少 10,000 次操作）。
认证验证：系统必须由 UL 或等效机构认证，包括第三方实验室测试。日志记录所有测试数据，支持审计。
与您的设计契合：您的故障转移机制需扩展到并发警报测试；整合自动诊断工具可增强 FDA 下的验证要求。
10. 文档、标签和培训（补充：遗漏的核心要求）
标准强调提供清晰文档，以支持维护和用户培训。
标签和标记：设备上必须有永久标签，包括型号、序列号、警告（如“仅限紧急使用”）和 UL 认证标志。
用户手册和培训：提供安装、操作和维护手册，包括故障排除指南。培训材料需覆盖护理人员和居民。
与您的设计契合：您的 FHIR 集成可扩展到数字手册；确保标签符合 HIPAA 的隐私披露要求。

---
